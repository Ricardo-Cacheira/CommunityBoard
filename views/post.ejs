<!DOCTYPE html>
<html lang="en">

<head>

    <%- include('head'); %>

    <link rel="stylesheet" href="/css/community.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.2/socket.io.js"></script>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="/js/socket.io.js"></script>
    <script>
        var socket = io.connect();
        var postid = <%= postId %>;
    </script>

    <title>
        <%= page_title %>
    </title>
</head>

<body>

    <div id="app">
        <%- include('nav', communityList); %>
        
        
        <% if(belongs){ %>
            <%- include('comments', {postId, post, comments, userId}); %>
        <% }else{%>
            <%- include('request', {community}); %>
        <% }%>
                
        <%- include('sidebar', {community, belongs, role, requests, communityName, members}); %>

    </div>

<script src="/js/main.js"></script>

<script>
    var app = new Vue({
        el: '#app',
            data: {
                title: "somtin",
                comments: [
                <% for (let i = 0; i < comments.length; i++) { %>
                <% var element = comments[i]%>
                { userName: "<%= element.userName %>", date: "<%= element.date %>", text: "<%= element.text %>", id: "<%= element.id %>"}<% if(i != comments.length-1){ %>,<% } %>
                <% } %>
                ]
            },
        mounted: function () {}
    });
</script>

<script>
socket.on('comment', function (data) {
    // console.log("data: "+data);
    console.log("data.id: " + data.id + "| postid: "+ postid);
    if(data.id == postid)
    {
        console.log(data);
        app.comments.unshift({ userName: data.uName, date: data.date, text: data.comm, id: data.id});
        // app.comments.unshift({ userName: "fake", date: "fake", text: "fake", id: "fake"});
    }
    // socket.emit('my other event', { my: 'data' });
});
</script>


<script>
    $(function () {
        var dtToday = new Date();

        var month = dtToday.getMonth() + 1;
        var day = dtToday.getDate();
        var year = dtToday.getFullYear();
        var hours = dtToday.getHours();
        var min = dtToday.getMinutes();
        if (month < 10)
            month = '0' + month.toString();
        if (day < 10)
            day = '0' + day.toString();

        var maxDate = year + '-' + month + '-' + day + "T" + hours + ":" + min;
        console.log(maxDate);
        $('#dato').attr('min', maxDate);
    });
</script>

<script>
    $('#commentb').click(function() {
    if($('textarea#commentt').val() == '')
    {
        alert("empty");
    }else
    {
        var text = $('textarea#commentt').val();
        var post = <%= postId   %>;
        comment(post, text);
        $('textarea#commentt').val('');
    }
    });
</script>

</body>

</html>